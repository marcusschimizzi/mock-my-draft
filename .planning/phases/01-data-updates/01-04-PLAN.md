---
phase: 01-data-updates
plan: 04
type: execute
wave: 4
depends_on: ['03']
files_modified:
  - apps/mmd-public/src/lib/data-status.ts
  - apps/mmd-public/src/types/index.ts
  - apps/mmd-public/src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Users see player data and rankings sourced from the latest published data version.'
    - 'Admin can trigger a manual import and see whether it succeeded or failed.'
    - 'Daily import runs on schedule and keeps the last good data if a run fails.'
    - 'User-facing UI shows a Last updated timestamp for the current dataset.'
  artifacts:
    - path: 'apps/mmd-public/src/lib/data-status.ts'
      provides: 'Public data status hook'
    - path: 'apps/mmd-public/src/app/page.tsx'
      provides: 'Last updated display for users'
  key_links:
    - from: 'apps/mmd-public/src/app/page.tsx'
      to: 'apps/mmd-public/src/lib/data-status.ts'
      via: 'useDataStatus'
      pattern: 'useDataStatus'
---

<objective>
Show the current data refresh timestamp in the public UI.

Purpose: Make the "Last updated" date visible to users and confirm data freshness.
Output: Public data status hook and UI display on the main page.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-data-updates/01-CONTEXT.md
@.planning/phases/01-data-updates/01-RESEARCH.md

@apps/mmd-public/src/lib/api-client.ts
@apps/mmd-public/src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add public data status hook and type</name>
  <files>
    apps/mmd-public/src/lib/data-status.ts
    apps/mmd-public/src/types/index.ts
  </files>
  <action>
    Add a DataStatus type in mmd-public types to match the `/api/data-imports/status` response. Create data-status.ts with `getDataStatus` using apiClient and a `useDataStatus` hook using React Query (match patterns in existing lib hooks). Ensure the hook returns `dataStatus` and `isLoading` fields.
  </action>
  <verify>yarn nx lint mmd-public</verify>
  <done>Public app can fetch the current data status from the API.</done>
</task>

<task type="auto">
  <name>Task 2: Display last updated timestamp on the homepage</name>
  <files>
    apps/mmd-public/src/app/page.tsx
  </files>
  <action>
    In the home page, call `useDataStatus` near other hooks and render a small text line near the top heading that shows "Last updated: {date}" when available, or "Last updated: pending" while loading. Use Chakra Text styling consistent with existing headings and avoid introducing new layout containers.
  </action>
  <verify>yarn nx lint mmd-public</verify>
  <done>Homepage shows a last updated date sourced from the data status endpoint.</done>
</task>

</tasks>

<verification>
- Public home page displays last updated timestamp and continues to load draft summary data.
</verification>

<success_criteria>

- Users can see the data refresh timestamp without admin access.
  </success_criteria>

<output>
After completion, create `.planning/phases/01-data-updates/01-04-SUMMARY.md`
</output>
