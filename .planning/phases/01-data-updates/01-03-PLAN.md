---
phase: 01-data-updates
plan: 03
type: execute
wave: 3
depends_on: ['02']
files_modified:
  - apps/admin/src/lib/data-imports.ts
  - apps/admin/src/types/index.ts
  - apps/admin/src/components/data-import-card.tsx
  - apps/admin/src/app/(dashboard)/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Users see player data and rankings sourced from the latest published data version.'
    - 'Admin can trigger a manual import and see whether it succeeded or failed.'
    - 'Daily import runs on schedule and keeps the last good data if a run fails.'
    - 'User-facing UI shows a Last updated timestamp for the current dataset.'
  artifacts:
    - path: 'apps/admin/src/lib/data-imports.ts'
      provides: 'Admin hooks for import status and manual trigger'
    - path: 'apps/admin/src/app/(dashboard)/page.tsx'
      provides: 'Manual import UI and last updated display'
  key_links:
    - from: 'apps/admin/src/app/(dashboard)/page.tsx'
      to: 'apps/admin/src/lib/data-imports.ts'
      via: 'React Query hooks'
      pattern: 'useDataImportStatus'
---

<objective>
Expose manual import controls and data status on the admin dashboard.

Purpose: Give admins an explicit way to trigger refreshes and verify timing.
Output: Admin hooks and dashboard card for import status + manual trigger.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-data-updates/01-CONTEXT.md
@.planning/phases/01-data-updates/01-RESEARCH.md

@apps/admin/src/lib/api-client.ts
@apps/admin/src/lib/players.ts
@apps/admin/src/components/data-summary.tsx
@apps/admin/src/app/(dashboard)/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add admin data import hooks and types</name>
  <files>
    apps/admin/src/lib/data-imports.ts
    apps/admin/src/types/index.ts
  </files>
  <action>
    Add a DataImportStatus type to admin types that mirrors the `/api/data-imports/status` response (activeVersionId, lastUpdated, playerCount, rankingCount, lastRunStatus). Create data-imports.ts with `getDataImportStatus` and `runManualImport` functions using apiClient, plus React Query hooks `useDataImportStatus` and `useManualDataImport` that invalidate the status query on success. Follow existing patterns in players.ts for naming and query invalidation.
  </action>
  <verify>yarn nx lint admin</verify>
  <done>Admin hooks fetch status and trigger manual import with cache refresh.</done>
</task>

<task type="auto">
  <name>Task 2: Add manual import card to admin dashboard</name>
  <files>
    apps/admin/src/components/data-import-card.tsx
    apps/admin/src/app/(dashboard)/page.tsx
  </files>
  <action>
    Create a DataImportCard component styled like DataSummary cards (use boxShadow and Chakra Box/Heading) that shows Last updated, last run status, player count, and a "Run Manual Import" button. Show a loading state when status is fetching and disable the button while mutation is pending. Render the new card in the dashboard SimpleGrid before the existing DataSummary cards. Use concise date formatting (e.g., toLocaleDateString) and avoid new dependencies.
  </action>
  <verify>yarn nx lint admin</verify>
  <done>Admin dashboard shows data status and allows manual import.</done>
</task>

</tasks>

<verification>
- Admin dashboard displays last updated data and manual import triggers API call.
</verification>

<success_criteria>

- Admin can run a manual import from the dashboard and see status update.
  </success_criteria>

<output>
After completion, create `.planning/phases/01-data-updates/01-03-SUMMARY.md`
</output>
